<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>30ç§’ã˜ã‚ƒã‚“ã‘ã‚“ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP" rel="stylesheet" />
  <link rel="stylesheet" href="css/janken.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- <script src="./js/main.js" defer></script> -->
</head>

<body>

  <main>

    <div class="container">
      <h1>30ç§’ã˜ã‚ƒã‚“ã‘ã‚“ãƒãƒ£ãƒ¬ãƒ³ã‚¸ </h1>

    <!-- èª¬æ˜ -->
    <div class="setumei">
    <span class="box-title">ãƒ«ãƒ¼ãƒ«</span> 
     <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã˜ã‚ƒã‚“ã‘ã‚“ã‚’ã—ã¾ã™</p>
     <p>30ç§’ä»¥å†…ã«ã€Œå‹ã¡æ•°ã‚’<span class="kachisu">ï¼˜</span>ä»¥ä¸Šã€ã«ã§ããŸã‚‰ã‚ãªãŸã®å‹ã¡</p>
    </div>

      <button id="startButton">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button> 
      <button id="resetButton" disabled>ãƒªã‚»ãƒƒãƒˆ</button>


        <!-- ã‚¿ã‚¤ãƒãƒ¼ -->
          <div class="timer">
            æ®‹ã‚Šæ™‚é–“: <span id="time-left">30</span> ç§’
        </div>

    <section class="result_section">
      <p id="result">ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ‰‹ã¯ï¼Ÿï¼Ÿ</p>
    </section>

    <section class="shohai_section">      
      <p id="shohai">å‹æ•—ã¯ï¼Ÿï¼Ÿ</p>
      <p id="winCount_mosugu"></p>
    </section>

    <section class="kaisu_section" >
      <div class="total">
      <p id="totalGames_title">è©¦åˆæ•°</p>
      <p id="totalGames">0</p>
      </div>

      <div class="win">
      <p id="winCount_title">å‹ã¡æ•°</p>
      <p id="winCount">0</p>
      </div>

      <div class="lose">
      <p id="loseCount_title">è² ã‘æ•°</p>
      <p id="loseCount">0</p>
      </div>

      <div class="draw">
      <p id="drawCount_title">ã‚ã„ã“æ•°</p>
      <p id="drawCount">0</p>
      </div>

    </section>

 <p id="messageArea">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”¨ãƒœã‚¿ãƒ³</p>

 <!-- 25å›ä»¥ä¸Šã«ãªã£ãŸãŠçŸ¥ã‚‰ã› -->
 <p id="messageArea" ></p>

    <!-- ã‚°ãƒ¼ãƒãƒ§ã‚­ãƒãƒ¼ãƒœã‚¿ãƒ³ -->
    <section class="button_section">
      <button id="button_g" disabled>âœŠã‚°ãƒ¼</button>
      <button id="button_c" disabled>âœŒãƒãƒ§ã‚­</button>
      <button id="button_p" disabled>âœ‹ãƒ‘ãƒ¼</button>
    </section>
  </main>


<script>


// å‹ã¡è² ã‘ã®æ•°ã®ã‚«ã‚¦ãƒ³ãƒˆ

let totalGames = 0;
let winCount = 0;
let loseCount = 0;
let drawCount = 0;

// ã‚¿ã‚¤ãƒãƒ¼ID
let countDownTimer; // 30ç§’å…¨ä½“ã‚¿ã‚¤ãƒãƒ¼
let roundTimer;     // 3ç§’ã”ã¨ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¤ãƒãƒ¼
let roundTimeout;   // 3ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆIDã‚’ä¿æŒã™ã‚‹å¤‰æ•°

// ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã®åˆæœŸå€¤
let count = 30; // 30ç§’å…¨ä½“ã‚¿ã‚¤ãƒãƒ¼
const ROUND_TIME = 3; // 1ãƒ©ã‚¦ãƒ³ãƒ‰3ç§’
let roundTimeLeft = ROUND_TIME; // 3ç§’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒãƒ¼

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ©ã‚¦ãƒ³ãƒ‰å†…ã«æ‰‹ã‚’å‡ºã—ãŸã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
let playerPlayed = false;

// ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒé¸æŠã—ãŸæ‰‹ (0:ã‚°ãƒ¼, 1:ãƒãƒ§ã‚­, 2:ãƒ‘ãƒ¼)
let computerHand = -1;

// å¤‰æ•°ã®å–å¾—
const startButton = document.querySelector('#startButton');
const resetButton = document.querySelector('#resetButton');
const countdownDisplay = document.querySelector('#time-left');
const totalGamesDisplay = document.querySelector('#totalGames');
const winCountDisplay = document.querySelector('#winCount');
const loseCountDisplay = document.querySelector('#loseCount');
const drawCountDisplay = document.querySelector('#drawCount');
const resultDisplay = document.querySelector('#result');
const shohaiDisplay = document.querySelector('#shohai');
const messageArea = document.querySelector('#messageArea');
const winCount_mosugu = document.querySelector('#winCount_mosugu');

const button_g = document.querySelector('#button_g');
const button_c = document.querySelector('#button_c');
const button_p = document.querySelector('#button_p');

// ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã˜ã‚ƒã‚“ã‘ã‚“ãƒœã‚¿ãƒ³ã‚’éæ´»æ€§ã«ã™ã‚‹
button_g.disabled = true;
button_c.disabled = true;
button_p.disabled = true;

// --- ãƒªã‚»ãƒƒãƒˆå‡¦ç†é–¢æ•° ---
function resetGame() {
    // å…¨ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
    clearInterval(countDownTimer);
    clearInterval(roundTimer);
    clearTimeout(roundTimeout); // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚‚ã‚¯ãƒªã‚¢

    // 1. ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
    count = 30;
    roundTimeLeft = ROUND_TIME;
    countdownDisplay.textContent = count;

    // 2. ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã€ç”»é¢ã«åæ˜ 
    totalGames = 0;
    winCount = 0;
    loseCount = 0;
    drawCount = 0;

    totalGamesDisplay.textContent = totalGames;
    winCountDisplay.textContent = winCount;
    loseCountDisplay.textContent = loseCount;
    drawCountDisplay.textContent = drawCount;

    // 3. å‹æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆæœŸåŒ–
    resultDisplay.textContent = "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ‰‹ã¯ï¼Ÿ";
    shohaiDisplay.textContent = "å‹æ•—ã¯ï¼Ÿ";

    // 4. ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    startButton.disabled = false; // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æ´»æ€§åŒ–
    resetButton.disabled = true; // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’éæ´»æ€§åŒ–
    button_g.disabled = true; // ã˜ã‚ƒã‚“ã‘ã‚“ãƒœã‚¿ãƒ³ã‚’éæ´»æ€§åŒ–
    button_c.disabled = true;
    button_p.disabled = true;

    // 5. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
    messageArea.textContent = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”¨ãƒœã‚¿ãƒ³';
    winCount_mosugu.textContent = '';

    // #resultã®èƒŒæ™¯è‰²ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
    $("#result").removeClass("bg-rock bg-scissors bg-paper");
    // #rbodyã®èƒŒæ™¯è‰²ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã®ã‚¯ãƒ©ã‚¹ã‚‚å‰Šé™¤)
    $("body").removeClass("body-win body-lose");
    $(messageArea).removeClass("messageArea-win messageArea-lose");
}

// --- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
$('#resetButton').on('click', resetGame);


// --- 30ç§’å…¨ä½“ã‚¿ã‚¤ãƒãƒ¼ã‚’ç®¡ç†ã™ã‚‹é–¢æ•° ---
function startCountdownTimer() {
    function countDown() {
        if (count > 0) {
            count--;
            countdownDisplay.textContent = count;
        } else {
            // 30ç§’ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†æ™‚
            clearInterval(countDownTimer);
            clearInterval(roundTimer); // ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¤ãƒãƒ¼ã‚‚åœæ­¢
            clearTimeout(roundTimeout); //  æœ€å¾Œã«è¨­å®šã•ã‚ŒãŸã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚‚ã‚¯ãƒªã‚¢
            countdownDisplay.textContent = 0;

            // ã‚²ãƒ¼ãƒ çµ‚äº†å¾Œã®ãƒœã‚¿ãƒ³çŠ¶æ…‹
            startButton.disabled = false;
            resetButton.disabled = true;
            button_g.disabled = true;
            button_c.disabled = true;
            button_p.disabled = true;

            // ç›®æ¨™é”æˆã®åˆ¤å®š
            if (winCount >= 8) {
                messageArea.textContent = "ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ç›®æ¨™é”æˆãŠã‚ã§ã¨ã†ï¼ğŸ‰";
                $(messageArea).addClass("messageArea-win");
                $("body").addClass("body-win");
            } else {
                messageArea.textContent = "ã‚²ãƒ¼ãƒ çµ‚äº†ï¼æ®‹å¿µ...";
                $(messageArea).addClass("messageArea-lose");
                $("body").addClass("body-lose");
            }
        }
    }
    // ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹
    countDownTimer = setInterval(countDown, 1000);
}


// --- 3ç§’ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¤ãƒãƒ¼/ã˜ã‚ƒã‚“ã‘ã‚“å‡¦ç†ã‚’è¡Œã†é–¢æ•° ---
function startRound() {
    // 30ç§’ã‚¿ã‚¤ãƒãƒ¼ãŒçµ‚äº†ã—ã¦ã„ãŸã‚‰ã€ã“ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¯é–‹å§‹ã—ãªã„
    if (count <= 0) {
        clearInterval(roundTimer);
        return;
    }

    // ä»¥å‰ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã§è¨­å®šã•ã‚ŒãŸæ™‚é–“åˆ‡ã‚Œåˆ¤å®šã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    clearTimeout(roundTimeout); 

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ“ä½œã‚’å—ã‘ä»˜ã‘ã‚‹ãŸã‚ã€å¿…ãšãƒœã‚¿ãƒ³ã‚’æ´»æ€§åŒ–ã™ã‚‹
    playerPlayed = false;
    button_g.disabled = false;
    button_c.disabled = false;
    button_p.disabled = false;

    // ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ‰‹ã‚’æ±ºå®š (0:ã‚°ãƒ¼, 1:ãƒãƒ§ã‚­, 2:ãƒ‘ãƒ¼)
    computerHand = Math.floor(Math.random() * 3);

    // ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ‰‹ã‚’è¡¨ç¤º
    const hands = ["âœŠã‚°ãƒ¼", "âœŒãƒãƒ§ã‚­", "âœ‹ãƒ‘ãƒ¼"];
    const classes = ["bg-rock", "bg-scissors", "bg-paper"];

    // #resultã‹ã‚‰å…¨ã¦ã®èƒŒæ™¯è‰²ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
    $("#result").removeClass(classes.join(' '));
    // ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ‰‹ã¨èƒŒæ™¯è‰²ã‚’è¡¨ç¤º
    resultDisplay.textContent = hands[computerHand];
    $("#result").addClass(classes[computerHand]);
    shohaiDisplay.textContent = "3ç§’ä»¥å†…ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ï¼"; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒã™

    // 3ç§’å¾Œã«åˆ¤å®š
    // â˜…ä¿®æ­£ç®‡æ‰€: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆIDã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿æŒã™ã‚‹â˜…
    roundTimeout = setTimeout(() => {
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ‰‹ã‚’å‡ºã—ã¦ã„ãªã„å ´åˆã®ã¿æ™‚é–“åˆ‡ã‚Œè² ã‘å‡¦ç†ã‚’è¡Œã†
        if (!playerPlayed) {
            totalGames++;
            loseCount++;
            totalGamesDisplay.textContent = totalGames;
            loseCountDisplay.textContent = loseCount;
            shohaiDisplay.textContent = "æ™‚é–“åˆ‡ã‚Œï¼è² ã‘..."; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è² ã‘
            
            // æ™‚é–“åˆ‡ã‚Œã®å ´åˆã‚‚ãƒœã‚¿ãƒ³ã‚’éæ´»æ€§åŒ–
            button_g.disabled = true;
            button_c.disabled = true;
            button_p.disabled = true;
        }
    }, ROUND_TIME * 1000);
}


// --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã˜ã‚ƒã‚“ã‘ã‚“å‡¦ç† ---
function playJanken(playerHand) {
    // æ—¢ã«æ‰‹ã‚’å‡ºã—ã¦ã„ã‚‹ã€ã¾ãŸã¯å…¨ä½“ã‚¿ã‚¤ãƒãƒ¼ãŒåˆ‡ã‚Œã¦ã„ãŸã‚‰ç„¡è¦–
    if (playerPlayed || count <= 0) {
        return;
    }

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ‰‹ã‚’å‡ºã—ãŸãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
    playerPlayed = true;

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ“ä½œã‚’ç„¡åŠ¹ã«ã™ã‚‹ï¼ˆæ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ãŒå§‹ã¾ã‚‹ã¾ã§æ“ä½œä¸å¯ï¼‰
    button_g.disabled = true;
    button_c.disabled = true;
    button_p.disabled = true;

    // â˜…é‡è¦è¿½åŠ : ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ‰‹ã‚’å‡ºã—ãŸå ´åˆã€æ™‚é–“åˆ‡ã‚Œåˆ¤å®šã‚’å³åº§ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹â˜…
    clearTimeout(roundTimeout);


    // --- å‹æ•—åˆ¤å®š ---
    totalGames++;
    totalGamesDisplay.textContent = totalGames;

    // å‹æ•—ãƒ­ã‚¸ãƒƒã‚¯ (0:ã‚°ãƒ¼, 1:ãƒãƒ§ã‚­, 2:ãƒ‘ãƒ¼)
    let resultText = "";
    if (playerHand === computerHand) {
        resultText = "ã‚ã„ã“";
        drawCount++;
        drawCountDisplay.textContent = drawCount;
    } else if (
        (playerHand === 0 && computerHand === 1) || // âœŠ vs âœŒ -> å‹ã¡
        (playerHand === 1 && computerHand === 2) || // âœŒ vs âœ‹ -> å‹ã¡
        (playerHand === 2 && computerHand === 0)    // âœ‹ vs âœŠ -> å‹ã¡
    ) {
        resultText = "å‹ã¡";
        winCount++;
        winCountDisplay.textContent = winCount;
    } else {
        resultText = "è² ã‘";
        loseCount++;
        loseCountDisplay.textContent = loseCount;
    }

    shohaiDisplay.textContent = resultText;
    checkWinMessage();
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯é–¢æ•°ã‚’å®šç¾©
function checkWinMessage() {
    if (winCount >= 5 && winCount < 7) {
        winCount_mosugu.textContent = "ã‚ã¨" + (8 - winCount) + "å›ï¼";
    } else if (winCount >= 8) {
        winCount_mosugu.textContent = "8å›ã‚’è¶…ãˆã¾ã—ãŸï¼ï¼";
    } else {
        winCount_mosugu.textContent = '';
    }
}


// --- ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
$('#startButton').on('click', function() {
    // ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆå‰ã«çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
    resetGame();

    // äºŒé‡èµ·å‹•é˜²æ­¢
    if (startButton.disabled) {
        return;
    }

    // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
    startButton.disabled = true; Â  // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’éæ´»æ€§åŒ–
    resetButton.disabled = false;

    // 30ç§’å…¨ä½“ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹
    startCountdownTimer();

    // æœ€åˆã®ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’é–‹å§‹
    startRound();
    // 3ç§’ã”ã¨ã«ãƒ©ã‚¦ãƒ³ãƒ‰ã‚’é–‹å§‹
    roundTimer = setInterval(startRound, ROUND_TIME * 1000);
});

// --- ã˜ã‚ƒã‚“ã‘ã‚“ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---

// ã‚°ãƒ¼ãƒœã‚¿ãƒ³
$("#button_g").on("click", function () {
    playJanken(0);
});

// ãƒãƒ§ã‚­ãƒœã‚¿ãƒ³
$("#button_c").on("click", function () {
    playJanken(1);
});

// ãƒ‘ãƒ¼ãƒœã‚¿ãƒ³
$("#button_p").on("click", function () {
    playJanken(2);
});

</script>
 

</body>

</html>